<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Typed Text + Signature to PDF</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    #sigCanvas {
      border: 2px dashed #6c757d;
      width: 100%;
      height: 200px;
      touch-action: none;
    }
  </style>
</head>
<body class="bg-light">
  <div class="container py-5">
    <div class="card shadow-lg">
      <div class="card-body">
        <h2 class="card-title mb-4">Sign a Message</h2>

        <form method="POST" action="generate_pdf.php" onsubmit="return saveSignature();">
          <div class="mb-3">
            <label for="message" class="form-label">Your Message</label>
            <textarea class="form-control" id="message" name="message" rows="5" placeholder="Type your text here..." required></textarea>
          </div>

          <div class="mb-3">
            <label for="username" class="form-label">Your Name</label>
            <input type="text" class="form-control" id="username" name="username" required>
          </div>

          <div class="mb-3">
            <label class="form-label">Signature</label>
            <canvas id="sigCanvas"></canvas>
            <div class="mt-2">
              <button type="button" class="btn btn-secondary btn-sm" onclick="clearCanvas()">Clear Signature</button>
            </div>
          </div>

          <input type="hidden" name="signature" id="signature">

          <button type="submit" class="btn btn-primary">Generate PDF</button>
        </form>
      </div>
    </div>
  </div>

  <script>
    const canvas = document.getElementById("sigCanvas");
    const ctx = canvas.getContext("2d");

    canvas.width = canvas.offsetWidth;
    canvas.height = 200;

    let drawing = false;

    function getPos(event) {
      const rect = canvas.getBoundingClientRect();
      if (event.touches) {
        return {
          x: event.touches[0].clientX - rect.left,
          y: event.touches[0].clientY - rect.top
        };
      } else {
        return {
          x: event.clientX - rect.left,
          y: event.clientY - rect.top
        };
      }
    }

    function startDrawing(e) {
      drawing = true;
      const pos = getPos(e);
      ctx.beginPath();
      ctx.moveTo(pos.x, pos.y);
    }

    function draw(e) {
      if (!drawing) return;
      const pos = getPos(e);
      ctx.lineTo(pos.x, pos.y);
      ctx.stroke();
    }

    function stopDrawing() {
      drawing = false;
      ctx.closePath();
    }

    canvas.addEventListener("mousedown", startDrawing);
    canvas.addEventListener("mousemove", draw);
    canvas.addEventListener("mouseup", stopDrawing);
    canvas.addEventListener("mouseout", stopDrawing);
    canvas.addEventListener("touchstart", startDrawing);
    canvas.addEventListener("touchmove", draw);
    canvas.addEventListener("touchend", stopDrawing);

    function clearCanvas() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    function saveSignature() {
      const data = canvas.toDataURL("image/png");
      document.getElementById("signature").value = data;
      return true;
    }
  </script>
</body>
</html>
